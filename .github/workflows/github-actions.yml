name: DeepRVAT
run-name: DeepRVAT 🧬🧪💻🧑‍🔬
on: [push]

env:
  CUDA_VISIBLE_DEVICES: ""

jobs:
  DeepRVAT-Pipeline-Smoke-Tests:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - uses: mamba-org/setup-micromamba@v1.4.3
        with:
          environment-name: deeprvat-gh-action
          environment-file: ${{ github.workspace }}/deeprvat_env.yaml
          cache-environment: true
          cache-downloads: true

      - name: Install DeepRVAT
        run: pip install -e ${{ github.workspace }}
        shell: micromamba-shell {0}
      - name: Run custom command in micromamba environment
        run: snakemake --version
        shell: micromamba-shell {0}
      - name: Run pipeline
        run: python -m snakemake -j 1 --directory ${{ github.workspace }}/example --snakefile ${{ github.workspace }}/pipelines/training_association_testing.snakefile --show-failed-logs --config pl_trainer.gpus=0
        shell: micromamba-shell {0}
