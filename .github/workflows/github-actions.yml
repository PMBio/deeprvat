name: DeepRVAT
run-name: DeepRVAT üß¨üß™üíªüßë‚Äçüî¨
on: [ push ]
jobs:
  Main-DeepRVAT-Pipeline-Smoke-Tests:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Training Association Testing smoke test
        uses: snakemake/snakemake-github-action@v1.24.0
        with:
          directory: 'example'
          snakefile: 'pipelines/training_association_testing.snakefile'
          args: '-j 1 -n'
          stagein: 'pip install -e ${{ github.workspace }}'
      - name: Seed Gene Discovery Smoke Test
        uses: snakemake/snakemake-github-action@v1.24.0
        with:
          directory: 'example'
          snakefile: 'pipelines/seed_gene_discovery.snakefile'
          args: '-j 1 -n'
      - name: Link pretrained models
        run: cd ${{ github.workspace }}/example && ln -s ../pretrained_models
      - name: Association Testing Pretrained Smoke Test
        uses: snakemake/snakemake-github-action@v1.24.0
        with:
          directory: 'example'
          snakefile: 'pipelines/association_testing_pretrained.snakefile'
          args: '-j 1 -n'
  Pre-DeepRVAT-Pipeline-Smoke-Tests:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Create pvcf_blocks.txt
        run: mkdir -pv example/vcf/metadata && touch example/vcf/metadata/pvcf_blocks.txt
      - name: Annotations Smoke Test
        uses: snakemake/snakemake-github-action@v1.24.0
        with:
          directory: 'example'
          snakefile: 'pipelines/annotations.snakefile'
          args: '-j 1 -n --configfile pipelines/config/deeprvat_annotation_config.yaml'
      - name: Create pvcf_blocks.txt
        run: mkdir -pv /data/metadata && touch /data/metadata/pvcf_blocks.txt
      - name: Preprocess Smoke Test
        uses: snakemake/snakemake-github-action@v1.24.0
        with:
          directory: 'example'
          snakefile: 'pipelines/preprocess.snakefile'
          args: '-j 1 -n --configfile pipelines/config/deeprvat_preprocess_config.yaml'
