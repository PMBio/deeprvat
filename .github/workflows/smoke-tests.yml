name: DeepRVAT Pipeline tests
run-name: DeepRVAT Pipeline tests üß¨üß™üíªüßë‚Äçüî¨
on: [ push ]

jobs:
  Smoke-RunTraining:
    call-workflow-in-local-repo:
      uses: ./.github/workflows/run-pipeline.yml
    with:
      environment-file: ${{ github.workspace }}/deeprvat_env_no_gpu.yml
      name: Smoke-RunTraining
      pipeline_cmd: |
            python -m snakemake -n -j 2 --directory ${{ github.workspace }}/example \
            --snakefile ${{ github.workspace }}/pipelines/run_training.snakefile --show-failed-logs


#  Pipeline-Tests-RunTraining:
#    runs-on: ubuntu-latest
#    needs: Smoke-RunTraining
#    steps:
#      - name: Check out repository code
#        uses: actions/checkout@v4
#      - uses: mamba-org/setup-micromamba@v1.8.1
#        with:
#          environment-name: deeprvat-gh-action
#          environment-file: ${{ github.workspace }}/deeprvat_env_no_gpu.yml
#          cache-environment: true
#          cache-downloads: true
#      - name: Install DeepRVAT
#        run: pip install -e ${{ github.workspace }}
#        shell: micromamba-shell {0}
#      # There are no GPUs on the gh worker, so we disable it in the config
#      - name: Update config to use no gpus
#        run: "sed -i 's/gpus: 1/gpus: 0/' ${{ github.workspace }}/example/config.yaml"
#        shell: bash -el {0}
#      - name: Run run_training pipeline
#        run: |
#          python -m snakemake -j 2 --directory ${{ github.workspace }}/example \
#          --snakefile ${{ github.workspace }}/pipelines/run_training.snakefile --show-failed-logs -F
#        shell: micromamba-shell {0}

