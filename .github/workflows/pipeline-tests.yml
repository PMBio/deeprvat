name: DeepRVAT Pipeline Tests
run-name: DeepRVAT Pipeline Tests üß¨üß™üíªüßë‚Äçüî¨
on: [ push ]

jobs:
  # Training Pipeline
  Smoke-RunTraining:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/run_training.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      postrun_cmd: echo "Hello World from post"

  Pipeline-Tests-RunTraining:
    needs: Smoke-RunTraining
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/run_training.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      dry_run: false
      postrun_cmd: python --version

  # Association Testing Pretrained Pipeline
  Smoke-Association-Testing-Pretrained:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/association_testing_pretrained.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      prerun_cmd: cd ./example && ln -s ../pretrained_models

  Pipeline-Tests-Training-Association-Testing:
    needs: Smoke-Association-Testing-Pretrained
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/association_testing_pretrained.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      prerun_cmd: cd ./example && ln -s ../pretrained_models
      dry_run: false

  # Association Testing Pretrained Regenie
  Smoke-Association-Testing-Pretrained-Regenie:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/association_testing_pretrained_regenie.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      prerun_cmd: cd ./example && ln -s ../pretrained_models

  Pipeline-Tests-Association-Testing-Pretrained-Regenie:
    needs: Smoke-Association-Testing-Pretrained-Regenie
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/association_testing_pretrained_regenie.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      prerun_cmd: cd ./example && ln -s ../pretrained_models
      dry_run: false

  # Association Testing Training
  Smoke-Association-Testing-Training:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/training_association_testing.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml

  Pipeline-Tests-Association-Testing-Training:
    needs: Smoke-Association-Testing-Training
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/training_association_testing.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      dry_run: false

  # Association Testing Training Regenie
  Smoke-Association-Testing-Training-Regenie:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/training_association_testing_regenie.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml

  Pipeline-Tests-Training-Association-Testing-Regenie:
    needs: Smoke-Association-Testing-Training-Regenie
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/training_association_testing_regenie.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      dry_run: false

  # Seed Gene Discovery
  Smoke-Seed-Gene-Discovery:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/seed_gene_discovery.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      prerun_cmd: cd ./example && cp ../deeprvat/seed_gene_discovery/config.yaml .

  Pipeline-Tests-Seed-Gene-Discovery:
    needs: Smoke-Seed-Gene-Discovery
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/seed_gene_discovery.snakefile
      environment_file: ./deeprvat_env_no_gpu.yml
      prerun_cmd: cd ./example && cp ../deeprvat/seed_gene_discovery/config.yaml .
      dry_run: false

  # Preprocessing With QC
  Smoke-Preprocessing-With-QC:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/preprocess_with_qc.snakefile
      environment_file: ./deeprvat_preprocessing_env.yml
      pipeline_directory: ./example/preprocess
      pipeline_config: ./pipelines/config/deeprvat_preprocess_config.yaml
      download_fasta_data: true
      fasta_download_path: ./example/preprocess/workdir/reference

  Pipeline-Tests-Preprocessing-With-QC:
    needs: Smoke-Preprocessing-With-QC
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/preprocess_with_qc.snakefile
      environment_file: ./deeprvat_preprocessing_env.yml
      pipeline_directory: ./example/preprocess
      pipeline_config: ./pipelines/config/deeprvat_preprocess_config.yaml
      dry_run: false
      download_fasta_data: true
      fasta_download_path: ./example/preprocess/workdir/reference

  # Preprocessing-No-QC
  Smoke-Preprocessing-No-QC:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/preprocess_no_qc.snakefile
      environment_file: ./deeprvat_preprocessing_env.yml
      pipeline_directory: ./example/preprocess
      pipeline_config: ./pipelines/config/deeprvat_preprocess_config.yaml
      download_fasta_data: true
      fasta_download_path: ./example/preprocess/workdir/reference

  Pipeline-Tests-Preprocessing-No-QC:
    needs: Smoke-Preprocessing-No-QC
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/preprocess_no_qc.snakefile
      environment_file: ./deeprvat_preprocessing_env.yml
      pipeline_directory: ./example/preprocess
      pipeline_config: ./pipelines/config/deeprvat_preprocess_config.yaml
      dry_run: false
      download_fasta_data: true
      fasta_download_path: ./example/preprocess/workdir/reference

  # Annotation Pipeline
  Smoke-Annotation-Pipeline:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/annotations.snakefile
      environment_file: ./deeprvat_annotations.yml
      pipeline_config: ./pipelines/config/deeprvat_annotation_config.yaml
      pipeline_directory: ./example/annotations
