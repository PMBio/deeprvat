name: DeepRVAT Pipeline Tests
run-name: DeepRVAT Pipeline Tests 🧬🧪💻🧑‍🔬
on: [ push ]

jobs:

  # Annotation Pipeline
  Smoke-Annotation-Pipeline:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/annotations.snakefile
      environment_file: ./deeprvat_annotations.yml
      pipeline_config: ./pipelines/config/deeprvat_annotation_config.yaml
      pipeline_directory: ./example/annotations
      download_fasta_data: true
      fasta_download_path: ./example/annotations/reference

  Pipeline-Tests-Annotation:
    needs: Smoke-Annotation-Pipeline
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/annotations.snakefile
      environment_file: ./deeprvat_annotations.yml
      pipeline_directory: ./example/annotations
      pipeline_extra_flags: --use-conda --conda-frontend micromamba
      pipeline_config: ./pipelines/config/deeprvat_annotation_minimal_config.yaml
      dry_run: false
      prerun_cmd: |
        bash ./deeprvat/annotations/setup_annotation_workflow.sh cache Plugins ./example/annotations/repo_dir clean && \
        df -h  && \
        sed -i "s/tensorflow-gpu/tensorflow/"  ./pipelines/resources/environment_spliceai_rocksdb.yaml
      download_fasta_data: true
      fasta_download_path: ./example/annotations/reference
