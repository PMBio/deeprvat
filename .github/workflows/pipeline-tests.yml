name: DeepRVAT Pipeline Tests
run-name: DeepRVAT Pipeline Tests üß¨üß™üíªüßë‚Äçüî¨
on: [ push ]

jobs:

  # Annotation Pipeline
  Smoke-Annotation-Pipeline:
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/annotations.snakefile
      environment_file: ./deeprvat_annotations.yml
      pipeline_config: ./pipelines/config/deeprvat_annotation_config.yaml
      pipeline_directory: ./example/annotations
      download_fasta_data: true
      fasta_download_path: ./example/annotations/reference

  Pipeline-Tests-Annotation:
    needs: Smoke-Annotation-Pipeline
    uses: ./.github/workflows/run-pipeline.yml
    with:
      pipeline_file: ./pipelines/annotations.snakefile
      env:
        CONDA_OVERRIDE_CUDA: 11.8
      environment_file: ./deeprvat_annotations.yml
      pipeline_directory: ./example/annotations
      pipeline_extra_flags: --use-conda --conda-frontend conda
      pipeline_config: ./pipelines/config/deeprvat_annotation_minimal_config.yaml
      dry_run: false
      prerun_cmd: bash ./deeprvat/annotations/setup_annotation_workflow.sh cache Plugins ./example/annotations/repo_dir && export CONDA_OVERRIDE_CUDA="11.8"
      download_fasta_data: true
      fasta_download_path: ./example/annotations/reference
